import pytest
from bs4 import BeautifulSoup

@pytest.fixture
def soup():
    with open("index.html", encoding="utf-8") as f:
        return BeautifulSoup(f, "html.parser")

# === Individual Requirement Tests ===

def test_document_structure(soup):
    assert soup.find("html"), "Missing <html> tag"
    assert soup.find("head"), "Missing <head> tag"
    assert soup.find("body"), "Missing <body> tag"

def test_header_and_footer(soup):
    assert soup.find("header"), "Portfolio must have a <header>"
    assert soup.find("footer"), "Portfolio must have a <footer>"

def test_navigation(soup):
    nav = soup.find("nav")
    assert nav, "Missing <nav> navigation"
    links = nav.find_all("a")
    assert len(links) >= 3, "Navigation must have at least 3 links"

def test_about_me_section(soup):
    about = soup.find(id="about")
    assert about, "Missing About Me section with id='about'"
    assert about.find("h2"), "About section missing heading"
    paragraphs = about.find_all("p")
    assert len(paragraphs) >= 2, "About section must have at least 2 <p> paragraphs"

def test_skills_list(soup):
    skills = soup.find(id="skills")
    assert skills, "Missing Skills section with id='skills'"
    items = skills.find_all("li")
    assert len(items) >= 3, "Skills list must have at least 3 items"

def test_projects_table(soup):
    table = soup.find("table")
    assert table, "Missing <table> for projects/experience"
    rows = table.find_all("tr")
    assert len(rows) >= 2, "Table must have at least 1 header row and 1 data row"

def test_contact_form(soup):
    form = soup.find("form")
    assert form, "Missing <form> in contact section"
    assert form.find("input", {"type": "text"}), "Form must have a text input (name)"
    assert form.find("input", {"type": "email"}), "Form must have an email input"
    assert form.find("button"), "Form must have a <button> to submit"

def test_image_present(soup):
    assert soup.find("img"), "Portfolio must include at least one <img> (profile or project)"

# ðŸš€ BONUS TEST
def test_title_contains_name(soup):
    title_tag = soup.find("title")
    assert title_tag, "Missing <title> tag in <head>"
    assert "Student" not in title_tag.text, "Replace 'Student Name' with your actual name in <title>"
    assert len(title_tag.text.strip()) > 0, "Title cannot be empty â€“ include your name!"


# âœ… AUTOGRADING SUMMARY TEST
def test_autograding_summary(soup):
    """
    Autograding summary â€“ assigns points for each requirement.
    This test always passes, but prints a grade summary.
    """
    score = 0
    total = 10  # 8 core (1 mark each) + 1 bonus (2 marks)

    # Document structure
    if soup.find("html") and soup.find("head") and soup.find("body"):
        score += 1

    # Header & footer
    if soup.find("header") and soup.find("footer"):
        score += 1

    # Navigation
    nav = soup.find("nav")
    if nav and len(nav.find_all("a")) >= 3:
        score += 1

    # About Me
    about = soup.find(id="about")
    if about and about.find("h2") and len(about.find_all("p")) >= 2:
        score += 1

    # Skills
    skills = soup.find(id="skills")
    if skills and len(skills.find_all("li")) >= 3:
        score += 1

    # Projects table
    table = soup.find("table")
    if table and len(table.find_all("tr")) >= 2:
        score += 1

    # Contact form
    form = soup.find("form")
    if form and form.find("input", {"type": "text"}) and form.find("input", {"type": "email"}) and form.find("button"):
        score += 1

    # Image
    if soup.find("img"):
        score += 1

    # Bonus: Title has actual name (2 marks)
    title_tag = soup.find("title")
    if title_tag and "Student" not in title_tag.text and len(title_tag.text.strip()) > 0:
        score += 2

    print(f"\n=== AUTOGRADING SUMMARY ===\nScore: {score}/{total}\n")
    assert True, f"Autograding completed. Score: {score}/{total}"
